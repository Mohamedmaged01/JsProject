<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link rel="stylesheet" href="../styles/Admin.css" />
  </head>
  <body>
    <div class="admin-container">
      <h1>Admin Dashboard</h1>
      <div class="admin-options">
        <button onclick="manageCourses()">Manage Courses</button>
        <button onclick="manageCategories()">Manage Categories</button>
        <button onclick="manageStudents()">Manage Students</button>
        <button onclick="manageRegistrations()">Manage Registrations</button>
        <button onclick="logout()">Logout</button>
      </div>

      <!-- Course Management Section -->
      <div id="courseManagement" class="management-section">
        <h2>Manage Courses</h2>
        <form id="courseForm">
          <input
            type="text"
            id="courseName"
            placeholder="Course Name"
            required
          />
          <input
            type="text"
            id="courseDescription"
            placeholder="Description"
            required
          />
          <select id="courseCategory" required>
            <!-- Categories will be populated dynamically -->
          </select>
          <button type="submit">Add Course</button>
        </form>
        <ul id="courseList">
          <!-- Courses will be populated dynamically -->
        </ul>
      </div>

      <!-- Category Management Section -->
      <div id="categoryManagement" class="management-section">
        <h2>Manage Categories</h2>
        <form id="categoryForm">
          <input
            type="text"
            id="categoryName"
            placeholder="Category Name"
            required
          />
          <button type="submit">Add Category</button>
        </form>
        <ul id="categoryList">
          <!-- Categories will be populated dynamically -->
        </ul>
      </div>

      <!-- Student Management Section -->
      <div id="studentManagement" class="management-section">
        <h2>Manage Students</h2>
        <table id="studentTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Progress</th>
            </tr>
          </thead>
          <tbody>
            <!-- Students will be populated dynamically -->
          </tbody>
        </table>
      </div>

      <!-- Registration Management Section -->
      <div id="registrationManagement" class="management-section">
        <h2>Manage Registrations</h2>
        <table id="registrationTable">
          <thead>
            <tr>
              <th>Student</th>
              <th>Course</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Registrations will be populated dynamically -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Helper functions for local storage
      const getData = (key) => {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      };

      const saveData = (key, data) => {
        localStorage.setItem(key, JSON.stringify(data));
      };

      // Initialize local storage with default data if empty
      const initializeLocalStorage = () => {
        if (!localStorage.getItem("courses")) saveData("courses", []);
        if (!localStorage.getItem("categories")) saveData("categories", []);
        if (!localStorage.getItem("students")) saveData("students", []);
        if (!localStorage.getItem("registrations"))
          saveData("registrations", []);
      };

      initializeLocalStorage();

      // Render Courses
      const renderCourses = () => {
        const courses = getData("courses");
        const courseList = document.getElementById("courseList");
        courseList.innerHTML = courses
          .map(
            (course) => `
        <li>
          ${course.name} - ${course.description}
          <button onclick="deleteCourse(${course.id})">Delete</button>
        </li>
      `
          )
          .join("");
      };

      // Render Categories (for management display)
      const renderCategories = () => {
        const categories = getData("categories");
        const categoryList = document.getElementById("categoryList");
        categoryList.innerHTML = categories
          .map(
            (category) => `
        <li>
          ${category.name}
          <button onclick="deleteCategory(${category.id})">Delete</button>
        </li>
      `
          )
          .join("");
        // Also update the course category <select> options.
        populateCourseCategorySelect();
      };

      // Populate the course category <select> element
      const populateCourseCategorySelect = () => {
        const categories = getData("categories");
        const courseCategorySelect = document.getElementById("courseCategory");
        let optionsHTML = "";
        // You could add a default "Select Category" option if desired.
        categories.forEach((category) => {
          optionsHTML += `<option value="${category.id}">${category.name}</option>`;
        });
        courseCategorySelect.innerHTML = optionsHTML;
      };

      // Render Students
      const renderStudents = () => {
        const students = getData("students");
        const studentTable = document
          .getElementById("studentTable")
          .querySelector("tbody");
        studentTable.innerHTML = students
          .map(
            (student) => `
        <tr>
          <td>${student.name}</td>
          <td>${student.email}</td>
          <td>${student.progress ? student.progress.length : 0} courses</td>
        </tr>
      `
          )
          .join("");
      };

      // Render Registrations
      const renderRegistrations = () => {
        const registrations = getData("registrations");
        const registrationTable = document
          .getElementById("registrationTable")
          .querySelector("tbody");
        registrationTable.innerHTML = registrations
          .map(
            (registration) => `
        <tr>
          <td>${registration.studentId}</td>
          <td>${registration.courseId}</td>
          <td>${registration.status}</td>
          <td>
            <button onclick="approveRegistration(${registration.id})">Approve</button>
            <button onclick="rejectRegistration(${registration.id})">Reject</button>
          </td>
        </tr>
      `
          )
          .join("");
      };

      // Add Course
      document.getElementById("courseForm").addEventListener("submit", (e) => {
        e.preventDefault();
        let randid = Math.floor(Math.random() * 10000);
        const course = {
          id: randid,
          name: document.getElementById("courseName").value,
          description: document.getElementById("courseDescription").value,
          categoryId: document.getElementById("courseCategory").value,
        };
        const courses = getData("courses");
        courses.push(course);
        saveData("courses", courses);
        renderCourses();
      });

      // Add Category
      document
        .getElementById("categoryForm")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          let randid = Math.floor(Math.random() * 10000);
          const category = {
            id: randid,
            name: document.getElementById("categoryName").value,
          };
          const categories = getData("categories");
          categories.push(category);
          saveData("categories", categories);
          renderCategories();
        });

      const logout = () => {
        localStorage.removeItem("token");
        localStorage.removeItem("loggedInUser");
        window.location.href = "Login.html";
      };

      // Initial rendering calls
      renderCourses();
      renderCategories();
      renderStudents();
      renderRegistrations();
      populateCourseCategorySelect();
    </script>
  </body>
</html>
